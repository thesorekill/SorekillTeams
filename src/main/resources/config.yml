# ============================================================================
# SorekillTeams - config.yml
# ============================================================================
# Plugin: https://github.com/thesorekill/SorekillTeams
#
# YAML tips:
# - Indentation matters (use spaces, not tabs)
# - Strings with special characters (&, :, #) should be in quotes
# ============================================================================


# ----------------------------------------------------------------------------
# Update Checker
# ----------------------------------------------------------------------------
# Checks Spigot for the latest version and:
# - logs to console if you're outdated
# - optionally notifies ops/admins when they join
update_checker:
  enabled: true

  spigot:
    # Used for the clickable link shown to admins + console messages
    history_url: "https://www.spigotmc.org/resources/sorekillteams.131034/history"

    # Used for the actual version check via Spiget
    resource_id: 131034

    # Optional (only used if history_url is missing)
    slug: "sorekillteams"

  notify_ops_on_join: true


# ----------------------------------------------------------------------------
# Storage
# ----------------------------------------------------------------------------
# How teams/homes are persisted.
storage:
  # yaml | sqlite | h2 | mysql | mariadb | postgresql
  type: yaml

  autosave_seconds: 60
  atomic_writes: true
  keep_backups: 3

  sql:
    # Network SQL (mysql/mariadb/postgresql)
    host: "127.0.0.1"

    # Use 0 to auto-pick defaults:
    # - mysql/mariadb: 3306
    # - postgresql: 5432
    port: 3306
    database: "sorekillteams"
    username: "root"
    password: "password"
    use_ssl: false

    # Local DB file name/path under the plugin folder (sqlite + h2 file mode)
    # Examples:
    # - "sorekillteams.db"
    # - "data/sorekillteams.db"
    # - "sorekillteams" (fine for H2)
    file: "sorekillteams.db"

    # H2 only:
    # - file: uses `file`
    # - memory: uses `database` as the in-memory DB name
    h2_mode: "file"
    h2_compatibility_mode: "MYSQL"

    # Optional extra driver params appended internally to JDBC
    # Example: "serverTimezone=UTC&useUnicode=true&characterEncoding=utf8"
    parameters: "sslmode=require"

    table_prefix: "st_"

    pool:
      maximum_pool_size: 10
      minimum_idle: 2
      connection_timeout_ms: 10000
      idle_timeout_ms: 600000
      max_lifetime_ms: 1800000
  
  migration:
    enabled: true

    # When should migration run?
    # - on_startup: migrate during onEnable after SQL connects, before loading into runtime service
    # - manual: only runs when you call a code path (future command)
    mode: "on_startup"

    # If true, migrate even if SQL already contains data (DANGEROUS)
    force: false

    # If true, after a successful migration it renames YAML files to *.migrated-backup
    # so you don’t accidentally think YAML is still the source of truth.
    rename_yaml_after_success: true

# ----------------------------------------------------------------------------
# Redis (Network Sync)
# ----------------------------------------------------------------------------
# Used for real-time cross-server updates (chat, invites, team updates, home updates).
# SQL is the source of truth; Redis is the "notify everyone instantly" layer.
redis:
  enabled: false

  host: "127.0.0.1"
  port: 6379
  password: ""
  use_ssl: false

  # Use either a single database index OR ACL users (your call)
  database: 0

  # Optional: set a client name to see connections in Redis monitoring
  client_name: "SorekillTeams"

  # Channel namespace (so multiple networks don’t collide)
  channel_prefix: "sorekillteams"

  # If you run multiple backend servers, this should be unique per server.
  server_id: "survival-1"

  # Reconnect & timeouts
  timeout_ms: 5000
  reconnect_delay_ms: 2000

# ----------------------------------------------------------------------------
# Team Rules
# ----------------------------------------------------------------------------
teams:
  # Default team size cap if the owner does NOT have a permission like:
  #   sorekillteams.max.5
  #   sorekillteams.max.10
  max_members_default: 4

  # Team name validation rules
  name:
    # Plain name length (after stripping formatting codes)
    min_length: 3
    max_length: 16

    # Allowed characters for the plain name (regex character class, no brackets)
    # Example: "a-zA-Z0-9_" allows letters, numbers, underscore
    allowed_plain: "a-zA-Z0-9_"

    # Formatting codes (applies only if allow_color_codes=true)
    # NOTE: Your validator currently allows:
    # - &0 - &9, &a - &f (colors)
    # - &l (bold) if allow_bold=true
    # - &r (reset) if allow_reset=true
    allow_color_codes: true
    allow_bold: true
    allow_reset: true

  # Block reserved names (case-insensitive) [could be useful to block curse words]
  reserved_names:
    enabled: true
    list:
      - "owner"
      - "admin"
      - "mod"
      - "helper"
      - "vip"
      - "default"

  # Prevent look-alike reserved names using Levenshtein distance
  # Example: "adm1n" could be blocked if within this distance of "admin"
  # Controls how strict it is on checking if it looks alike
  reserved_match:
    levenshtein_distance: 2


# ----------------------------------------------------------------------------
# Team Menus (Every menu is configurable in menus.yml)
# ----------------------------------------------------------------------------
menus:
  # Master switch for all GUI menus
  enabled: true

  # If true, running "/team" with no arguments opens the team menu
  # (Commands like "/team info", "/team invite", etc. are unaffected)
  open_on_team_command_no_args: true

  # If true, registers "/team menu" as a shortcut to open the GUI
  enable_team_menu_subcommand: true


# ----------------------------------------------------------------------------
# Invites
# ----------------------------------------------------------------------------
# Controls how inviting/accepting/denying works.
invites:
  # How long invites last before expiring (seconds)
  expiry_seconds: 300

  # Cooldown per inviter between sending invites (seconds)
  cooldown_seconds: 10

  # How often expired invites are purged from memory (seconds)
  purge_seconds: 60

  # Anti-spam controls
  # Max pending invites a player can have at one time
  max_pending_per_player: 5

  # Max outgoing pending invites a team can have at one time
  max_outgoing_per_team: 10

  # If false, a player can only have invites from ONE team at a time
  allow_multiple_from_different_teams: true

  # If true and a player has multiple invites:
  # you require specifying which invite to accept:
  #   /team accept <team>
  accept_requires_team_id_when_multiple: true

  # If true, re-inviting a player refreshes the expiry instead of creating a duplicate
  reinvite_refreshes_expiry: true


# ----------------------------------------------------------------------------
# Team Chat
# ----------------------------------------------------------------------------
# Provides:
# - /tc command
# - /team chat toggle mode (routes normal chat to team chat)
# - spy mode (admins can watch a team's chat)
chat:
  # Master switch for ALL team chat functionality
  enabled: true

  # Format for team chat messages
  # Tokens:
  #   {team}    team name
  #   {player}  sender name
  #   {message} message content
  #
  # Note:
  # - You can also use PlaceholderAPI placeholders (%...%) if PlaceholderAPI is installed
  #   and integrations.placeholderapi is true.
  # - You can also use MiniPlaceholders (<...>) if your chat pipeline supports MiniMessage
  #   AND MiniPlaceholders is installed + integrations.miniplaceholders is true.
  format: "&8&l(&c&l{team}&8&l) &f{player} &8&l> &c{message}"

  # Example (PlaceholderAPI) — commented out on purpose:
  # format: "&8&l(&c%player_name%&8&l) &7[%sorekillteams_team%] &f{player} &8&l> &c{message}"
  #
  # Example (MiniPlaceholders / MiniMessage style) — commented out on purpose:
  # format: "<dark_gray><bold>(<red><bold><sorekillteams_team><dark_gray><bold>) <white>{player} <dark_gray><bold>> <red>{message}"

  # If true, players can toggle "team chat mode" so their normal chat goes to team chat
  toggle_enabled: true

  # If true, players start in team-chat mode on join (usually annoying; default false)
  default_on_join: false

  # Enables debug logs for team chat interception/sending
  debug: false

  spy:
    # If true, spy feature is enabled (permission + watch list still required)
    enabled: true

    # Format for spy messages
    # Tokens: {team} {player} {message}
    format: "&8[&cTEAM SPY&8] &8(&c{team}&8) &f{player}&8: &7{message}"


# ----------------------------------------------------------------------------
# Friendly Fire
# ----------------------------------------------------------------------------
# Controls teammate damage prevention/reduction.
friendly_fire:
  # Global friendly fire switch:
  # - true  => plugin does NOT interfere (teammates hurt normally)
  # - false => plugin ENFORCES teammate rules (block/scale below)
  enabled: false

  # If true, players can toggle "friendly fire" for their team.
  toggle_enabled: true

  # When enabled=false and attacker+victim are teammates AND that team's FF is OFF:
  # How much damage should go through (0-100)?
  # - 0     = fully block teammate damage (classic no-friendly-fire)
  # - 1-99  = reduce damage (e.g., 25 = 25% damage)
  # - 100   = full damage (basically no reduction)
  teammate_damage: 0

  # Damage sources to include when FF enforcement is active (enabled=false)
  include_projectiles: true
  include_area_effect_clouds: true
  include_explosives: true

  # Additional sources
  # - Potions: only harmful effects count as "attack" (beneficial are ignored)
  include_potions: true
  include_tridents: true

  # Optional feedback message when a hit is blocked
  message:
    enabled: true
    cooldown_ms: 1000


# ----------------------------------------------------------------------------
# Team Homes
# ----------------------------------------------------------------------------
# Shared homes per team (requires homes.enabled=true in plugin wiring).
homes:
  enabled: true

  # Max homes allowed per team (unless you later add permission overrides)
  max_homes: 1

  # Metadata for networks / displays (stored with each home)
  server_name: "survival"

  # Teleport warmup time (seconds)
  warmup_seconds: 5

  # Cooldown between home teleports (seconds)
  cooldown_seconds: 60

  # Future proxy/network mode toggle (no effect unless implemented)
  proxy_mode: false

  # If proxy_mode is used:
  # prevent using a home created on a different server_name
  restrict_to_same_server: true


# ----------------------------------------------------------------------------
# Admin Safety Toggles
# ----------------------------------------------------------------------------
# Lets you “turn off” destructive admin actions without removing the command.
admin:
  allow_force_disband: true
  allow_set_owner: true
  allow_force_kick: true


# ----------------------------------------------------------------------------
# Integrations / Placeholders
# ----------------------------------------------------------------------------
# Placeholder formats:
#
# PlaceholderAPI (PAPI):
#   %sorekillteams_<placeholder>%
#
# MiniPlaceholders:
#   <sorekillteams_<placeholder>>
#
# You can use these in chat formats, scoreboards, nametags, actionbars, menus,
# or any plugin that supports PlaceholderAPI or MiniPlaceholders.
#
# ---------------------------------------------------------------------------
# Core team placeholders
# ---------------------------------------------------------------------------
# sorekillteams_team
#   -> Team name (blank if player is not in a team)
#
# sorekillteams_team_id
#   -> Team UUID (blank if not in a team)
#
# sorekillteams_in_team
#   -> "true" or "false"
#
# sorekillteams_team_owner
#   -> Team owner username (blank if none)
#
# sorekillteams_team_members
#   -> Total members (owner + members)
#
# ---------------------------------------------------------------------------
# Member count placeholders (numbers only)
# ---------------------------------------------------------------------------
# sorekillteams_members_total
#   -> Total members (owner + members)
#
# sorekillteams_members_online
#   -> Number of online team members
#
# sorekillteams_members_offline
#   -> Number of offline team members
#
# ---------------------------------------------------------------------------
# Team homes placeholders
# ---------------------------------------------------------------------------
# sorekillteams_homes_count
#   -> Number of homes the team has
#
# sorekillteams_home_1
# sorekillteams_home_2
# sorekillteams_home_3
# sorekillteams_home_4
# sorekillteams_home_5
#   -> Display name of the Nth team home (blank if missing)
#
# Notes:
# - Home placeholders return blanks if homes are disabled or the player has no team.
# - Online/offline counts are based on players online on THIS server.
# - MiniPlaceholders require a MiniMessage-compatible output plugin.
integrations:
  placeholderapi: true
  miniplaceholders: true


# ----------------------------------------------------------------------------
# File Names
# ----------------------------------------------------------------------------
files:
  # The file loaded by Msg.java for messages (prefix + message keys)
  messages: "messages.yml"
  menus: "menus.yml"
